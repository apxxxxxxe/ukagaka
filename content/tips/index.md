---
title: "TIPS"
date: "20220629"
tags: ["noindex"]
summery: ""
---

## 💬「......」で口パクアニメーションしないようにしたい

![center:kuchipaku.gif](kuchipaku.gif)

### シェルの口パク

[surfaces.txt のアニメーションインターバル定義](http://ssp.shillest.net/ukadoc/manual/descript_shell_surfaces.html#introduction_animationinterval)には、トークに合わせてanimationを動かすオプションのtalkがあります。
これを使うとトーク時に口を動かす表現が実現できます。ただし、これは「……」のようなセリフ的には無言の部分でも口が動いてしまいます。解決策を考えましょう。

### 解決策

- 「……」をクイックセクション(\\\_q)で囲む。

クイックセクションで表示された場所は一瞬で表示されます。これは当然口パクの対象外になります。  
そして、クイックセクションには範囲内のウェイト(\\w9や\\\_w[500]など)に対しては適用されない(指定したウェイト分一時停止する)という特徴があります。
つまり、クイックセクション内でも１文字ごとにウェイトを入れれば表面上は通常通りの表示になります。つまり、最終的には

```
\_q…\_w[500]…\_w[500]\_q
```

のようにすれば、通常通りの文章表示を維持しつつ口パクの有無を操作できます。  
その都度さくらスクリプトを仕込むのは大変なので、里々なら replace.txt、YAYA なら OnTranslate に置換処理を記述するとよいでしょう。

## 📊 連続して同じトークが来るのを避ける

たくさんのトーク群からどのようにトークを選び、喋らせるかはとても大事。自然なトーク選びができればゴーストの実在感、トークの没入感は高まる。  
トーク選びの基本処理は SHIORI がよしなにやってくれるけれど、デベ側からある程度ルールを設定することもできる。

### 前提

トーク被りを避け、出来るだけまんべんなくトークが選ばれるようにしたい。

#### 里々

『＄文「○」の重複回避』『＄単語群「○」の重複回避』を利用してトーク被りを回避できる。  
詳しくは[こちら](http://soliton.sub.jp/satori/index.php?%E7%89%B9%E6%AE%8A%E5%A4%89%E6%95%B0#o772b719)を参照

#### YAYA

関数のオプション「nooverlap」を指定することでトーク被りを回避できる。  
詳しくは[こちら](https://emily.shillest.net/ayaya/?%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB/%E6%96%87%E6%B3%95/2.%E9%96%A2%E6%95%B0#vce5bec3)を参照

#### 提案:ルーレット選択アルゴリズムを実装する(YAYA)

- editing

##### 実装例

拙作ゴースト「[Crave The Grave](https://github.com/apxxxxxxe/Haine/blob/main/ghost/master/yaya_rouletteselection.txt)」で実装されています。

## 🍃 トーク文章の表示速度を辞書側で調整したい

SSP のデフォルト表示速度は
50ms/文字(ユーザ側で調整可能)。これをゴースト側から変更したいことがある  
（早口、ゆったりの表現や長い文章をゆっくり表示したいなど）

### 実現するための考え方

- 遅らせたい場合、１文字ごとにウェイト(\\\_w\[25\]など)を入れて表示速度を調整すればよい
- 早めたい場合は上記に加えてさくらスクリプト\\\_q
  でデフォルトのウェイトを消す必要がある

問題はどうやってウェイトを挿入するか

### 具体的な方法(YAYA)

```
AddWait
{
    // _argv[0]: 対象文字列
    // _argv[1]: ウェイト[ms]
    // メッセージスピードの標準は50ms これに加算すると考えて調整

    _text = _argv[0]
    _wait = '\_w[' + _argv[1] + ']'

    // 適当な制御文字 YAYAは0x0を扱えないので0x1で
    _tagmark = CHR(0x1)
    // さくらスクリプトは_tagmarkに置き換えて退避
    //(さくらスクリプト中にウェイト記述が挟まって破綻するのを防ぐ)
    // 置換したさくらスクリプトは配列に保持しておいて適宜取り出す
    _t = RE_REPLACE(_text, '\\_{0,2}[a-zA-Z0-9*!&\-+](\d|\[("([^"]|\\")+?"|([^\]]|\\\])+?)+?\])?', _tagmark)
    _tags = RE_GETSTR

    _tagcount = 0
    _textlen = STRLEN(_argv[0])
    _result = ""
    for _i=0; _i<_textlen; _i++ {
        _c = SUBSTR(_t, _i, 1)
        if _c == _tagmark {
            _result += _tags[_tagcount]
            _tagcount += 1
        }
        else {
            _result += _c + _wait // #1
        }
    }
    _result
}

```

これはトークを遅らせる場合。早めたい場合、#1 部分で単語を\\\_q で囲めばデフォルトのウェイトを無効化できる

## 🔙 トークを日本語的にいい感じのところで自動改行したい

### トーク毎に改行にこだわるのは面倒

ゴーストのトークを書く際、通常の文章と異なる最も大きな点は改行だと思います。  
筆者は文章の中途半端なところで改行が挟まると読みづらいため、読みやすい部分で改行を入れるのですが、
一般的なブログサイトは1行60文字程度であるのに対して、伺かの標準バルーンは24文字(全角、SSP デフォルト+の場合)であり、トークを書いていると改行が頻繁に来るなと感じています。
そこで見栄えの良い改行を自動化し、デベロッパーがトークの内容に専念できるようにするにはどうすればよいかを考えました。

### 文節を機械的に見分けて処理する

見栄えの良い文章とは、すなわち意味の区切り=文節で改行が入っている文章です。
例えば、
```
吾輩は猫である。名前はまだない。
　どこで生れたか頓と見当がつかぬ。何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。吾輩はここで始めて人間というものを見た。
```
という文章をバルーンで表示する場合、そのまま書き込むとこうなります。
```
吾輩は猫である。名前はまだない。
　どこで生れたか頓と見当がつかぬ。何でも薄暗いじ
めじめした所でニャーニャー泣いていた事だけは記憶
している。吾輩はここで始めて人間というものを見た。
```
つぎに、以下で紹介する自動改行関数を通した場合こうなります。
```
吾輩は猫である。名前はまだない。
　どこで生れたか頓と見当がつかぬ。何でも
薄暗いじめじめした所でニャーニャー泣いて
いた事だけは記憶している。吾輩はここで始めて
人間というものを見た。
```
多少文末がでこぼこしますが、筆者は後者のほうが美しいと思います。  
何より、SSPとエディタを行き来しながら改行を調整する手間から開放されるのは大きいです。

### くわしい説明(YAYA)

形態素解析ソフト MeCab を実装したSAORI([kisaragi.dll](https://github.com/ponapalt/csaori))で文章を単語に分解し、各品詞から文節を割り出すことが可能です。
これを利用して、文章を文節ごとに改行する関数を作ります。

- editing

### 実装例

拙作ゴースト「[Crave The Grave](https://github.com/apxxxxxxe/Haine/blob/8f04e65e134431a3b2c6c884a35f287b5123d0bb/ghost/master/yaya_functions.txt#L168-L297)」で実装されています。

## 🔖 栞を最新版にしよう

#### よい

- 新機能が使える
- バグが修正され、不自由/危険が解消される
- 最新版をつかっているという安心感

#### わるい

- めんどうくさい(複数ゴースト等を抱えていると特に)

#### 解決策

- [複数の栞ファイルを一括で更新するツール](https://github.com/apxxxxxxe/shioriupdater)を使う
